function init(){map=new google.maps.Map(document.getElementById("map-holder"),{center:{lat:53.5547142,lng:9.9689018},zoom:16}),map.data.setControls(["Point","LineString","Polygon"]),map.data.setStyle({editable:!0,draggable:!0}),bindDataLayerListeners(map.data),dropContainer=document.getElementById("drop-container"),panel=document.getElementById("panel");var a=document.getElementById("map-holder");geoJsonInput=document.getElementById("geojson-input"),downloadLink=document.getElementById("download-link"),resizeGeoJsonInput(),[a,dropContainer].forEach(function(a){google.maps.event.addDomListener(a,"drop",handleDrop),google.maps.event.addDomListener(a,"dragover",showPanel)}),google.maps.event.addDomListener(a,"dragstart",showPanel),google.maps.event.addDomListener(a,"dragenter",showPanel),google.maps.event.addDomListener(dropContainer,"dragend",hidePanel),google.maps.event.addDomListener(dropContainer,"dragleave",hidePanel),google.maps.event.addDomListener(geoJsonInput,"input",refreshDataFromGeoJson),google.maps.event.addDomListener(geoJsonInput,"input",refreshDownloadLinkFromGeoJson),google.maps.event.addDomListener(window,"resize",resizeGeoJsonInput)}function refreshGeoJsonFromData(){map.data.toGeoJson(function(a){geoJsonInput.value=JSON.stringify(a,null,2),refreshDownloadLinkFromGeoJson()})}function refreshDataFromGeoJson(){var a=new google.maps.Data({map:map,style:map.data.getStyle(),controls:["Point","LineString","Polygon"]});try{var b=JSON.parse(geoJsonInput.value);a.addGeoJson(b)}catch(b){return a.setMap(null),void setGeoJsonValidity(""!==geoJsonInput.value?!1:!0)}map.data.setMap(null),map.data=a,bindDataLayerListeners(a),setGeoJsonValidity(!0)}function refreshDownloadLinkFromGeoJson(){downloadLink.href="data:;base64,"+btoa(geoJsonInput.value)}function bindDataLayerListeners(a){a.addListener("addfeature",refreshGeoJsonFromData),a.addListener("removefeature",refreshGeoJsonFromData),a.addListener("setgeometry",refreshGeoJsonFromData)}function setGeoJsonValidity(a){a?geoJsonInput.className="":geoJsonInput.className="invalid"}function showPanel(a){return a.stopPropagation(),a.preventDefault(),dropContainer.className="visible",!1}function hidePanel(){dropContainer.className=""}function handleDrop(a){a.preventDefault(),a.stopPropagation(),hidePanel();var b=a.dataTransfer.files;if(b.length)for(var d,c=0;d=b[c];c++){var e=new FileReader;e.onload=function(a){map.data.addGeoJson(JSON.parse(a.target.result))},e.onerror=function(a){console.error("reading failed")},e.readAsText(d)}else{var f=a.dataTransfer.getData("text/plain");f&&map.data.addGeoJson(JSON.parse(f))}return!1}function resizeGeoJsonInput(){var a=geoJsonInput.getBoundingClientRect(),b=panel.getBoundingClientRect();geoJsonInput.style.height=b.bottom-a.top-8+"px"}function toggle_visibility(a){var b=document.getElementById(a);"block"==b.style.display?b.style.display="none":b.style.display="block"}function changeWidth(a){var b=document.getElementById(a);"64.9%"==b.style.width?b.style.width="100%":b.style.width="64.9%"}function resizeMap(a){google.maps.event.trigger(a,"resize"),mapResized=!0}function panelToggle(){toggle_visibility("panel"),changeWidth("map-container"),resizeMap(map)}function readFromLocalStorageFunction(){void 0!=typeof localStorage.data&&window.confirm("Do you want to continue from where you left?")&&(document.getElementById("geojson-input").value=JSON.parse(localStorage.data))}function saveToLocalStorage(){localStorage.data=JSON.stringify(geoJsonInput.value)}var map,dropContainer,panel,geoJsonInput,downloadLink;document.addEventListener("DOMContentLoaded",readFromLocalStorageFunction,!1),setTimeout(saveToLocalStorage,3e5),google.maps.event.addDomListener(window,"load",init);var mapResized=!1;window.onbeforeunload=function(){return"Are you sure you want to leave?"};